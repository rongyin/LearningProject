# docker
1. docker run --name docker_mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:latest
2. docker exec -it docker_mysql /bin/bash
3. mysql -u root -p


# 数据库同步一致性解决方案
1. 异步复制
MySQL默认的复制是异步的，主库在执行完客户端提交的事务后会立即将结果返给给客户端，
并不关心从库是否已经接收并处理，这样就会有一个问题，主如果crash掉了，此时主上已经提交的事务可能并没有传到从库上。

2. 半同步复制
介于异步复制和全同步复制之间，主库在执行完客户端提交的事务后不是立刻返回给客户端，而是等待至少一个从库接收到并写到relay
log中才返回给客户端。

3. 数据库中间件
- 所有的读写都走数据库中间件，通常情况下，写请求路由到主库，读请求路由到从库
- 记录所有路由到写库的key，在主从同步时间窗口内（假设是500ms），如果有读请求访问中间件，此时有可能从库还是旧数据，就把这个key上的读请求路由到主库。
- 在主从同步时间过完后，对应key的读请求继续路由到从库。

4. 缓存记录写key法
- 写流程：

1）如果key要发生写操作，记录在cache里，并设置“经验主从同步时间”的cache超时时间，例如500ms

2）然后修改主数据库

- 读流程：

1）先到缓存里查看，对应key有没有相关数据

2）有相关数据，说明缓存命中，这个key刚发生过写操作，此时需要将请求路由到主库读最新的数据。

3）如果缓存没有命中，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离。



